<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品頁面</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/04_product_page.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/e72344855b.js" crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <nav class="header">
            <div class="d-flex">
                <a class="iconBorder" href="/Dealdove"><img class="icon" src="./images/icon.png"></a>
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search...">
                        <div class="search-icon">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div class="popular-categories">
                        <ul>
                            <li>洗衣精</li>
                            <li>花盆</li>
                            <li>衛生紙</li>
                            <li>吹風機</li>
                            <li>剪刀</li>
                            <li>手機殼</li>
                            <li>梳子</li>
                            <li>桌墊</li>
                            <li>馬克杯</li>
                            <li>聖誕樹</li>
                            <li>聖誕裝飾品</li>
                            <li>鉛筆盒</li>
                            <li>耳機</li>
                            <li>繪本</li>
                        </ul>
                    </div>
                </div>
                <div class="header_link">
                    <ul>
                        <li>
                            <svg width="1.1vw" height="1.1vw" viewBox="0 0 22 20" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path
                                        d="M8.94965 9.24365L1.60819 15.6852C0.797271 16.3967 0.797271 17.5503 1.60819 18.2618C2.41909 18.9733 3.73385 18.9733 4.54476 18.2618L11.8862 11.8203"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                        d="M16.3651 12.1523L20.3917 15.6853C21.2027 16.3968 21.2027 17.5505 20.3917 18.2619C19.5809 18.9735 18.2661 18.9735 17.4552 18.2619L11.0093 12.6063"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                        d="M5.50522 4.95963L3.30278 5.60379L1.10034 2.38304L2.56863 1.09473L6.23937 3.02718L5.50522 4.95963ZM5.50522 4.95963L8.44367 7.53788"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                        d="M8.94955 9.2435C8.07349 7.28218 8.24477 4.70872 10.0508 3.12408C11.8568 1.53943 15.1898 1.19163 17.0252 2.15785L13.8682 4.9278L13.5748 7.76186L16.8048 7.50441L19.9617 4.73445C21.063 6.34483 20.6666 9.26929 18.8606 10.8539C17.0545 12.4385 14.1215 12.5889 11.8862 11.8201"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            </i><a href="./10_seller_home_page.html"
                                   class=" link-underline link-underline-opacity-0 text-secondary"> 賣場管理</a>
                        </li>
                        <li>
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw   " viewBox="0 0 20 22"
                                 fill="none">
                                <path d="M1 21V19.75C1 14.9175 4.91751 11 9.75 11C14.5825 11 18.5 14.9175 18.5 19.75V21"
                                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                        d="M9.75 11C12.5114 11 14.75 8.76138 14.75 6C14.75 3.23857 12.5114 1 9.75 1C6.98857 1 4.75 3.23857 4.75 6C4.75 8.76138 6.98857 11 9.75 11Z"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            </i><a id="member" href="/Member"
                                   class=" link-underline link-underline-opacity-0 text-secondary "> 會員中心</a>
                        </li>
                        <li>
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw" viewBox="0 0 17 20"
                                 fill="none">
                                <path
                                        d="M13.5 9.86888H15.25C15.6642 9.86888 16 10.1635 16 10.5269V17.985C16 18.3484 15.6642 18.643 15.25 18.643H1.75C1.33579 18.643 1 18.3484 1 17.985V10.5269C1 10.1635 1.33579 9.86888 1.75 9.86888H3.5M13.5 9.86888V5.48181C13.5 4.01945 12.5 1.09473 8.5 1.09473C4.5 1.09473 3.5 4.01945 3.5 5.48181V9.86888M13.5 9.86888H3.5"
                                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            </i><a id="login" href="/Login"
                                   class=" link-underline link-underline-opacity-0 text-secondary">
                            註冊/登入</a>
                        </li>
                    </ul>
                </div>
                <div class="cart_container">
                    <a href="./08_shopping_cart.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="2.7vw" height="2.7vw" viewBox="0 0 40 32"
                            fill="none">
                            <path
                                d="M39.1404 6.20728C38.947 5.97764 38.6949 5.79109 38.4043 5.66266C38.1136 5.53422 37.7927 5.4675 37.4673 5.46788L12.6088 5.48008L12.3246 4.26477C11.7939 1.79221 9.3536 -0.00140304 6.5207 8.23529e-07L2.0818 0.0021945C0.93 0.00272095 -0.00059971 0.821964 2.89972e-07 1.83082C0.00070029 2.83967 0.9323 3.65804 2.0842 3.65751L6.523 3.65532C7.352 3.65488 8.071 4.19554 8.2382 4.96854L8.869 7.67502C8.869 7.67862 8.8732 7.68046 8.8732 7.68414V7.69327L11.7886 19.5716C11.8884 19.9803 12.145 20.3466 12.5156 20.6092C12.8862 20.8718 13.3482 21.0149 13.8246 21.0145L30.7927 21.0061C33.4257 21.0049 35.4557 19.5545 36.2102 17.1727L39.46 7.82822C39.6534 7.27431 39.5322 6.67301 39.1403 6.20719L39.1404 6.20728ZM16.6801 23.7546C14.3826 23.7558 12.5151 25.3961 12.5165 27.412C12.5178 29.4279 14.3872 31.0664 16.6848 31.0653C18.9823 31.0641 20.8498 29.4238 20.8485 27.4079C20.8472 25.392 18.9777 23.7535 16.6801 23.7546ZM30.2196 23.748C27.9221 23.7491 26.0546 25.3894 26.056 27.4054C26.0573 29.4212 27.9267 31.0598 30.2243 31.0586C32.5218 31.0575 34.3893 29.4172 34.388 27.4013C34.3867 25.3854 32.5172 23.7468 30.2196 23.748Z"
                                fill="white" />
                        </svg>
                    </a>
                </div>
            </div>
        </nav>
        </header>
        <main>
            <section class="mb-5" >
                <div class="row product mt-5">
                    <div class="col-5 productImage">
                        <div class="row col-12 text-center bigImage">
                            <img id="mainImage" src="./images/p1.jpeg" alt="圖片描述">
                        </div>
                        <div class="row col-12 justify-content-center smallImage" style="margin-bottom: 1vw">
                            <div class="col-1"><button id="prevBtn">&lt</button></div>
                            <div class="col-3" >
                                <img src="./images/p1.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-3 ">
                                <img src="./images/p2.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/p3.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/商品圖.png" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/商品圖2.jpg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/商品圖3.jpg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/p1.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/p2.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-3">
                                <img src="./images/p3.jpeg" alt="圖片描述">
                            </div>
                            <div class="col-1 ps-0"><button id="nextBtn">&gt</button></div>
                        </div>
                    </div>

                    <div class="col-7 productDescribe">
                        <p id="productidmodel" style="display: none"></p>
                        <p class="productName" id="productName">商品名稱</p>
                        <ul class="col-12 justify-content-start evaluate ">
<!--                            <li class="col-1">3.1</li>-->
<!--                            <li class="col-1"></li>-->
                            <li class="col-3">84評價</li>
                            <li class="col-3">810售出</li>
<!--                            <li class="col-3"><a href="">加入收藏</a></li>-->
                        </ul>
                        <div id="specificContainer"></div>

                        <div class="col-12 quantity">
                            <p>數量</p>
                            <button id="increaseBtn">+</button>
                            <input id="quantityValue" style="padding:0.5vw 1.4vw; width:4vw;" value="1" readonly/>
                            <button id="decreaseBtn" style="margin-right: 2vw;">-</button>
                            <p>庫存 <p id="quantity"></p></p>
                            <input name="firstModelid" style="display: none;"/>
                            <input name="secondModelid" style="display: none;"/>

                        </div>
                        <div class="col-12 price">
                            <p>價格</p>
                            <span id="price"></span>
                        </div>
                        <div class="col-12 d-flex text-center">
                            <button class="buy">直接下單</button>
                            <button class="add" id="addCart">加入購物車</button>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <div id="userid"></div>
                <div class="row seller">
                    <div class="col-5">
                        <div class="col-7 d-flex">
                            <div class="col-5 profileImage"><img src="./images/userImg4.png" alt=""></div>
                            <p class="sellerName">賣家名稱<br><span>粉絲數:<span>1532</span></span></p>
                        </div>
                        <div class="col-7 d-flex collect">
                            <a href="">加入收藏</a>
                            <a href="">私訊賣家</a>
                        </div>
                    </div>
                    <div class="col-7 d-flex text-center sellerDecribe">
                        <div class="col-3">
                            <p>154</p>
                            <p>商品總數</p>
                        </div>
                        <div class="col-3">
                            <p>56</p>
                            <p>賣場評價</p>
                        </div>
                        <div class="col-3">
                            <p>98%</p>
                            <p>聊聊回應率</p>

                        </div>
                        <div class="col-3">
                            <p>1.2%</p>
                            <p>不成功率</p>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <div class="row p-4 productDescribe2">
                    <p>商品描述</p>
                    <div class="div descriptionBorder">
                        <div id="descriptionContent"></div>
                    </div>
                </div>
            </section>
            <section>
                <div class="comment">
                    <p class="row">商品評論</p>
                    <div class="bar row">
                        <div class="col-1">全部<span></span></div>
                        <div class="col-1">5星<span></span></div>
                        <div class="col-1">4星<span></span> </div>
                        <div class="col-1">3星<span></span></div>
                        <div class="col-1">2星<span></span></div>
                        <div class="col-1">1星<span></span></div>
<!--                        <span class="col-5  text-center">5.0/5</span>-->
                    </div>
                    <div class="row userComment">
                        <div class="user">
                            <span class="userName">使用者名稱:<img class="userIcon" src="./images/userImg2.jpeg" ><span><b>@buydeep</b></span></span>
                            <span class="commentContainer">評價內容</span>
                        </div>
                        <div class="row productComment">
                            <div class="col-2 div  productCommentImage"><img src="./images/p2.jpeg" ></div>
                            <div class="col-2 div "></div>
                            <div class="col-7 div " style="margin-top:1.5vw">賣家寄貨快速包裝仔細，摸起來質感很不錯，尺寸也相當適合，價錢也是相當超值，準備洗過以後來穿了，以後有機會再來買</div>
                        </div>
                        <div class="user">
                            <span class="userName">使用者名稱:<img class="userIcon" src="./images/userImg1.jpeg" ><span><b>@buydeep</b></span></span>
                            <span class="commentContainer">評價內容</span>
                        </div>
                        <div class="row productComment">
                            <div class="col-2 div  productCommentImage"></div>
                            <div class="col-2 div "></div>
                            <div class="col-7 div " style="margin-top:1.5vw">賣家出貨速度很快，商品包裝妥當沒有任何破損，材質是純棉的穿起來超舒服，訂價也合適整體來說CP值很高，已經再這店家買過好幾次了下次如果還有需要會再回購，謝謝。</div>
                        </div>
                        <div class="commentPage d-flex justify-content-end ">
                            <button>&lt</button>
                            <button>1</button>
                            <button>2</button>
                            <button>3</button>
                            <button>4</button>
                            <button>5</button>
                            <button>&gt</button>
                        </div>
                    </div>
                </div>
                <div class="row similar">
                    <div class="title">類似商品</div>
                    <div class="row similarProduct">
                        <div class="col-3 border border-dark"></div>
                        <div class="col-3"></div>
                        <div class="col-3"></div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row similarProduct">
                        <div class="col-3 border border-dark"></div>
                        <div class="col-3"></div>
                        <div class="col-3"></div>
                        <div class="col-3"></div>
                    </div>
                    <div class="similarPage d-flex justify-content-center ">
                        <button>&lt</button>
                        <button>1</button>
                        <button>2</button>
                        <button>3</button>
                        <button>4</button>
                        <button>5</button>
                        <button>&gt</button>
                    </div>
                </div>
            </section>
        </main>
        <footer>
            <div class="footer">
                <div>
                    <ul class="footerList">
                        <li class="h3">關於我們</li>
                        <li>關於DealDove</li>
                        <li>加入我們</li>
                        <li>賣家中心</li>
                        <li>限時特賣</li>
                        <li>聯絡媒體</li>
                    </ul>
                </div>
                <div>
                    <ul class="footerList">
                        <li class="h3">客服中心</li>
                        <li>幫助中心</li>
                        <li>退貨退款</li>
                        <li>聯絡客服</li>
                    </ul>
                </div>
                <div>
                    <ul class="footerList">
                        <li class="h3">關注我們</li>
                        <li>關於DealDove</li>
                        <li>加入我們</li>
                        <li><img src="./images/icon _facebook.png"><span> </span><img
                                src="./images/icon _instagram.png"></li>
                    </ul>
                </div>
                <div>
                    <ul class="footerList">
                        <li class="h3">法律與隱私</li>
                        <li>隱私權政策</li>
                        <li>DealDove條款</li>
                    </ul>
                </div>
                <img class="qrcode" src="./images/qrCode.png">
            </div>
        </footer>
    <script src="./js/isLogin.js" type="module"></script>
    <script>
        let firName='';
        let secName='';

        //新增取得URL參數
        let urlParams = new URLSearchParams(window.location.search);
        let param = urlParams.get('productID');
        console.log(param+"param");
        document.getElementById('productidmodel').innerText=param;
                fetch(`api/products/getProduct/${param}`)
                    .then(response => response.json())
                    .then(product => product.forEach((product)=>{
                        document.getElementById('productName').innerText =product.productName;
                        document.getElementById('descriptionContent').innerText = product.productDes;

                        // 清空原有的內容
                        document.getElementById('specificContainer').innerHTML = '';
                        // 使用 Fetch API 來呼叫後端 API 取得產品規格
                        fetch(`api/products/${param}/specifications`)
                            .then(response => response.json())
                            .then(specifications => {
                                // 將規格資料動態生成到 HTML 中
                                Object.entries(specifications).forEach(([specType, specValues]) => {

                                    const specTypeContainer = document.createElement('div');
                                    specTypeContainer.classList.add('col-12', 'mt-3', 'specification');
                                    specTypeContainer.id = `container${specType}`;
                                    // 產生規格名稱的區塊
                                    const specTypeLabel = document.createElement('p');
                                    specTypeLabel.classList.add('col-2');
                                    if('name' in specValues){
                                        specTypeLabel.textContent = specValues['name'];
                                    }
                                    specTypeContainer.appendChild(specTypeLabel);

                                    // 產生規格內容的區塊
                                    specValues.dataMapList.forEach(data => {
                                        const specValuesContainer = document.createElement('div');
                                        specValuesContainer.classList.add('div');
                                        specValuesContainer.classList.add(`${specType}modelinfos`); //black
                                        specValuesContainer.textContent = data.name;

                                        const specValuesContainerName = document.createElement('div');
                                        specValuesContainerName.classList.add(`modelName`);
                                        specValuesContainerName.textContent = data.name;
                                        specValuesContainerName.style.display = 'none';

                                        const specValuesContainer2 = document.createElement('div');
                                        specValuesContainer2.classList.add('modelid');
                                        specValuesContainer2.textContent = data.id;
                                        specValuesContainer2.style.display = 'none';

                                        specTypeContainer.appendChild(specValuesContainer);
                                        specValuesContainer.appendChild(specValuesContainer2);
                                        specValuesContainer.appendChild(specValuesContainerName);

                                        // 註冊點擊事件
                                        specValuesContainer.addEventListener('click', function() {
                                            const modelId = specValuesContainer.querySelector('.modelid').innerText;
                                            const modelName = specValuesContainer.querySelector('.modelName').innerText;


                                            if(`${specType}` === "map1"){
                                                const firstModelidInput = document.getElementsByName('firstModelid')[0];
                                                console.log(firstModelidInput+"firstModelidInput");
                                                const modelId1 = modelId; // 替換為實際的值
                                                console.log(modelId1+"modelId1");
                                                // 設置元素的值
                                                firstModelidInput.value = modelId1;
                                                // 創建 input 事件
                                                const inputEvent = new Event('input', {
                                                    bubbles: true,
                                                    cancelable: true,
                                                });
                                                // 分派 input 事件
                                                firstModelidInput.dispatchEvent(inputEvent);
                                                // selectedModelFir.push(modelName);
                                                firName=modelName;
                                                console.log(firName);
                                            }else{
                                                const secondModelidInput = document.getElementsByName('secondModelid')[0];
                                                const modelId2 = modelId;
                                                secondModelidInput.value = modelId2;
                                                const inputEvent = new Event('input', {
                                                    bubbles: true,
                                                    cancelable: true,
                                                });
                                                secondModelidInput.dispatchEvent(inputEvent);
                                                // selectedModelSec.push(modelName);
                                                secName=modelName;
                                                console.log(secName);
                                            }
                                        });
                                    });

                                    // 將整個規格區塊加入到主容器中
                                    document.getElementById('specificContainer').appendChild(specTypeContainer);

                                    // 新增換行元素
                                    const lineBreak = document.createElement('br');
                                    document.getElementById('specificContainer').appendChild(lineBreak);
                                });
                            })
                            .catch(error => console.log(error));
                    })).catch(error => console.log(error));


        const firstModelidInput = document.getElementsByName('firstModelid')[0];
        const secondModelidInput = document.getElementsByName('secondModelid')[0];

            firstModelidInput.addEventListener("input", handleInput);
            secondModelidInput.addEventListener("input", handleInput);

            function handleInput() {
                const firstModelid = firstModelidInput.value;
                const secondModelid = secondModelidInput.value;
                if(firstModelid!= '' && secondModelid != ''){   // 取到兩值才顯示庫存、價格
            fetch(`api/products/${param}/${firstModelid}/${secondModelid}/modelinfo`)
                .then(response => response.json())
                .then(modelinfo => {
                    document.getElementsByClassName('modelinfos');

                    document.getElementById('quantity').innerText = modelinfo.quantity;
                    document.getElementById('price').innerText = modelinfo.price;
                })
                .catch(error => console.log(error));
                }
        };
        document.addEventListener('DOMContentLoaded', function() {
            // 取得相關元素
            const quantityInput = document.getElementById('quantityValue');
            const increaseBtn = document.getElementById('increaseBtn');
            const decreaseBtn = document.getElementById('decreaseBtn');
            const quantitySpan = document.getElementById('quantity');

            // 初始化數量
            let quantity = 1;

            // 假設庫存為 10
            const stockQuantity = 50;
            //quantitySpan.textContent = stockQuantity;

            // 增加按鈕點擊事件
            increaseBtn.addEventListener('click', function() {
                if (quantity < stockQuantity) {
                    quantity++;
                    quantityInput.value = quantity;
                }
            });

            // 減少按鈕點擊事件
            decreaseBtn.addEventListener('click', function() {
                if (quantity > 1) {
                    quantity--;
                    quantityInput.value = quantity;
                }
            });
        });

    </script>
<!--    圖片-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainImage = document.getElementById('mainImage');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const smallImages = document.querySelectorAll('.smallImage .col-3');
            const totalImages = smallImages.length;
            const imagesPerSet = 3;
            let currentImageIndex = 0;

            // 初始化顯示前三個小圖
            showSmallImages(0, imagesPerSet - 1);

            prevBtn.addEventListener('click', function() {
                // 如果已經顯示到第一組小圖，則鎖定在前三個區塊
                console.log(currentImageIndex+"click");
                if (currentImageIndex <= 2) {
                    currentImageIndex = 0;
                    showSmallImages(0, imagesPerSet - 1);
                }else{
                    // 顯示上一個三個小圖
                    showSmallImages(currentImageIndex - imagesPerSet, currentImageIndex - 1);
                }
            });
            nextBtn.addEventListener('click', function() {
                // 顯示下一個三個console.log(currentImageIndex+"000currentImageIndex");小圖
                console.log(currentImageIndex+"11currentImageIndex");
                console.log(totalImages+"11hii");
                console.log(imagesPerSet+"11imagesPerSet");
                showSmallImages(currentImageIndex, currentImageIndex + imagesPerSet - 1);

                console.log(currentImageIndex+"currentImageIndex");
                console.log(totalImages+"hii");
                console.log(imagesPerSet+"imagesPerSet");
                // 如果已經顯示到最後一組小圖，則鎖定在倒數三個區塊
                if (currentImageIndex >= totalImages - imagesPerSet) {
                    currentImageIndex = totalImages - imagesPerSet;
                    showSmallImages(currentImageIndex, totalImages - 1);
                }
            });
            function showSmallImages(startIndex, endIndex) {
                // 隱藏所有小圖
                hideAllSmallImages();

                // 顯示指定範圍的小圖
                for (let i = startIndex; i <= endIndex; i++) {
                    if (smallImages[i]) {
                        smallImages[i].style.display = 'block';
                    }
                }

                // 更新目前顯示的小圖索引
                currentImageIndex = endIndex;
            }

            function hideAllSmallImages() {
                smallImages.forEach(image => {
                    image.style.display = 'none';
                });
            }
        });

    </script>
    <script src="./js/productpage.js" type="module"></script>
    <script src="./js/search.js"></script>
</body>

</html>